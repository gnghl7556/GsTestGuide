# Plan: 어드민 계정 & 관리 페이지

> **Feature**: 어드민-계정-관리
> **Created**: 2026-02-10
> **Status**: Reviewed (검토 완료)

---

## 1. 문제 정의

### 현재 상태
- Firebase Auth가 초기화되어 있지만 **익명 로그인(anonymous)만 사용** 중
- `UserRole` 타입이 정의되어 있지만 **코드 어디에서도 사용되지 않음**
- 어드민 전용 페이지 **없음**
- 사용자/프로젝트 관리를 위한 별도 인터페이스 **없음**

### 해결 방향
- 기존 익명 인증 **유지** (시험원은 별도 로그인 불필요)
- Admin은 **고정 1계정** (비밀번호 팝업으로 진입)
- 어드민 관리 페이지에서 사용자/프로젝트/시스템 설정 관리

---

## 2. 검토 결과 (사용자 답변)

### Q1. Admin 초기 계정
- **고정 1계정**: ID `TTA`, Password `12Sqecd34!`
- 첫 화면 우측 상단에 작은 '관리자 페이지' 버튼
- 클릭 시 **팝업창**으로 비밀번호 입력 → 일치하면 어드민 페이지 진입
- Firebase Auth 기반 로그인이 아닌 **앱 내부 비밀번호 검증** 방식

### Q2. Tester 계정 생성
- 현재 방식 유지 (사용자 디렉토리에서 관리)
- 별도 로그인/회원가입 불필요
- PL 정보로 Tester 계정 생성도 가능

### Q3. 기존 데이터
- 테스트용 데이터이므로 삭제 가능
- 단, **'모상현' 계정은 유지** (테스트용)

### Q4. 프로젝트 접근 범위
- **전체 프로젝트 열람 가능** (필터링 불필요)

### Q5. PL 역할
- PL은 별도 로그인 계정 불필요
- 현재처럼 연락처 정보로만 관리
- PL 등록 정보를 Tester 계정 생성에 활용 가능

---

## 3. 기능 범위 (수정)

### 3.1 MVP (이번 구현 대상)

#### A. Admin 진입 방식 (비밀번호 팝업)
- 첫 화면(대시보드) 우측 상단에 작은 '관리자 페이지' 버튼
- 클릭 시 모달 팝업: 비밀번호 입력 필드 + 확인/취소 버튼
- 비밀번호 일치 시 어드민 페이지(`/admin`)로 이동
- 세션 동안 어드민 인증 상태 유지 (새로고침 시 해제)
- **Firebase Auth 변경 없음** - 기존 익명 로그인 그대로 유지

#### B. 어드민 관리 페이지
- **`/admin`**: 어드민 대시보드 (진입점)
- **사용자 관리**: 시험원 목록, 생성, 수정, 삭제
- **프로젝트 관리**: 프로젝트 목록, 생성, 시험원 배정, 상태 변경
- 어드민 페이지에서 나가기 버튼 (일반 대시보드로 복귀)

#### C. Admin 라우트 보호
- `/admin/*` 경로 접근 시 어드민 인증 여부 확인
- 미인증 시 대시보드로 리다이렉트
- URL 직접 입력으로 우회 방지

### 3.2 비 변경 사항
- 기존 라우트(`/dashboard`, `/design`, `/execution`, `/report`) 변경 없음
- 기존 익명 인증 흐름 변경 없음
- Firestore 보안 규칙 변경 없음 (프론트엔드에서만 제어)
- 시험원 로그인/로그아웃 기능 없음

### 3.3 향후 확장 (이번 범위 아님)
- Firebase Auth 기반 실제 로그인 시스템
- Firestore 보안 규칙 역할 기반 강화
- 감사 로그 (audit trail)
- 시험원별 프로젝트 접근 제한

---

## 4. 기술 전략

### 4.1 인증 방식: 앱 내부 비밀번호 검증

**방식**: 환경변수(`VITE_ADMIN_PASSWORD`)에 비밀번호 저장 → 프론트에서 비교
- 간단하고 Firebase Auth 변경 불필요
- 보안 수준: 내부 도구 수준에 적합 (외부 공개 서비스 아님)
- 세션 상태: React state (또는 sessionStorage)로 관리

**진입 흐름:**
```
[대시보드] → '관리자 페이지' 버튼 클릭
                ↓
         [비밀번호 팝업 모달]
                ↓ 비밀번호 입력 + 확인
         [환경변수 값과 비교]
                ├─ 일치 → adminAuthenticated = true → /admin 이동
                └─ 불일치 → 에러 메시지 표시
```

### 4.2 프론트엔드 구조

```
src/
├── features/
│   └── admin/                          ← 신규
│       ├── components/
│       │   ├── AdminPasswordModal.tsx   ← 비밀번호 입력 팝업
│       │   ├── AdminLayout.tsx          ← 어드민 레이아웃 (사이드바)
│       │   ├── UserManagement.tsx       ← 사용자 CRUD
│       │   └── ProjectManagement.tsx    ← 프로젝트 관리
│       ├── hooks/
│       │   └── useAdminAuth.ts          ← 어드민 인증 상태 관리
│       └── routes/
│           └── AdminPage.tsx            ← /admin 라우트 진입점
```

### 4.3 라우트 구조 (변경 후)

```tsx
<Routes>
  {/* 기존 라우트 (변경 없음) */}
  <Route index element={<Navigate to="/dashboard" replace />} />
  <Route path="dashboard" element={<OverviewPage />} />
  <Route path="design" element={<DesignPage />} />
  <Route element={<WorkspaceLayout />}>
    <Route path="execution" element={<ExecutionPage />} />
    <Route path="report" element={<ReportPage />} />
  </Route>

  {/* 어드민 라우트 (신규) */}
  <Route path="admin" element={<AdminGuard />}>
    <Route index element={<AdminPage />} />
    <Route path="users" element={<UserManagement />} />
    <Route path="projects" element={<ProjectManagement />} />
  </Route>

  <Route path="*" element={<Navigate to="/dashboard" replace />} />
</Routes>
```

### 4.4 어드민 인증 상태 관리

```typescript
// useAdminAuth.ts
// sessionStorage 기반 - 탭 닫으면 해제, 새로고침에는 유지
const ADMIN_KEY = 'gs-admin-authenticated';

function useAdminAuth() {
  const [isAdmin, setIsAdmin] = useState(
    () => sessionStorage.getItem(ADMIN_KEY) === 'true'
  );

  const authenticate = (password: string): boolean => {
    if (password === import.meta.env.VITE_ADMIN_PASSWORD) {
      sessionStorage.setItem(ADMIN_KEY, 'true');
      setIsAdmin(true);
      return true;
    }
    return false;
  };

  const logout = () => {
    sessionStorage.removeItem(ADMIN_KEY);
    setIsAdmin(false);
  };

  return { isAdmin, authenticate, logout };
}
```

---

## 5. 기존 코드 영향도

### 변경 필요한 파일

| 파일 | 변경 내용 | 영향도 |
|------|----------|--------|
| `src/routes.tsx` | `/admin/*` 라우트 추가 | Medium |
| `src/components/Layout/GlobalProcessHeader.tsx` | '관리자 페이지' 버튼 추가 | Low |
| `.env` | `VITE_ADMIN_PASSWORD` 추가 | Low |

### 신규 생성 파일

| 파일 | 설명 |
|------|------|
| `src/features/admin/components/AdminPasswordModal.tsx` | 비밀번호 입력 팝업 |
| `src/features/admin/components/AdminLayout.tsx` | 어드민 레이아웃 |
| `src/features/admin/components/UserManagement.tsx` | 사용자 관리 |
| `src/features/admin/components/ProjectManagement.tsx` | 프로젝트 관리 |
| `src/features/admin/hooks/useAdminAuth.ts` | 어드민 인증 상태 |
| `src/features/admin/routes/AdminPage.tsx` | 어드민 라우트 가드 + 진입점 |

### 변경하지 않는 파일
- `src/lib/firebase.ts` - 변경 없음
- `src/hooks/useAuthReady.ts` - 익명 로그인 그대로 유지
- `firestore.rules` - 변경 없음
- `content/` 폴더 - 충돌 없음
- 체크리스트/결함보고 로직 - 기존 동작 유지

---

## 6. 구현 순서

### Phase 1: 어드민 인증 인프라
1. `.env`에 `VITE_ADMIN_PASSWORD` 추가
2. `useAdminAuth` 훅 구현 (sessionStorage 기반)
3. `AdminPasswordModal` 컴포넌트
4. `GlobalProcessHeader`에 '관리자 페이지' 버튼 추가

### Phase 2: 어드민 라우트 & 레이아웃
1. `AdminGuard` (라우트 가드)
2. `AdminLayout` (사이드바 네비게이션)
3. `routes.tsx`에 `/admin/*` 추가

### Phase 3: 어드민 기능 페이지
1. `UserManagement` (사용자 목록/생성/수정/삭제)
2. `ProjectManagement` (프로젝트 목록/생성/시험원배정/상태관리)

### Phase 4: 검증
1. 비밀번호 팝업 → 어드민 진입 테스트
2. URL 직접 접근 차단 테스트
3. 사용자/프로젝트 CRUD 테스트
4. 기존 기능 정상 동작 확인
5. `tsc --noEmit` + `vite build` 통과

---

## 7. 리스크 & 대응

| 리스크 | 영향 | 대응 |
|--------|------|------|
| 환경변수 비밀번호가 빌드에 포함됨 | Low | 내부 도구이므로 수용. 향후 Firebase Auth로 전환 가능 |
| 새로고침 시 어드민 상태 유실 | Low | sessionStorage 사용으로 탭 내 유지 |
| 어드민 페이지 URL 공유 시 접근 가능 | Low | AdminGuard가 sessionStorage 확인 후 차단 |

---

## 8. 성공 기준

- [ ] 대시보드 우측 상단에 '관리자 페이지' 버튼 표시
- [ ] 버튼 클릭 시 비밀번호 입력 팝업 표시
- [ ] 올바른 비밀번호 입력 시 어드민 페이지 진입
- [ ] 틀린 비밀번호 시 에러 메시지 표시
- [ ] 어드민 페이지에서 사용자 CRUD 가능
- [ ] 어드민 페이지에서 프로젝트 관리 가능
- [ ] `/admin` URL 직접 접근 시 인증 없으면 차단
- [ ] 기존 기능 정상 동작
- [ ] `tsc --noEmit` 및 `vite build` 통과
