# Design: 어드민 계정 & 관리 페이지

> **Feature**: 어드민-계정-관리
> **Created**: 2026-02-10
> **Plan Reference**: `docs/01-plan/features/어드민-계정-관리.plan.md`

---

## 1. 아키텍처 개요

### 1.1 핵심 설계 원칙
- **최소 변경**: 기존 익명 인증/라우트/Firestore 규칙 변경 없음
- **독립 모듈**: `src/features/admin/`에 모든 어드민 코드 격리
- **기존 훅 재사용**: `useDirectoryActions`, `useUsers`, `useProjects` 그대로 활용
- **UI 일관성**: 기존 Tailwind 패턴 + `Button`, `Input` 컴포넌트 재사용

### 1.2 데이터 흐름

```
[대시보드] → '관리자 페이지' 버튼 클릭
      ↓
[AdminPasswordModal] → 비밀번호 입력
      ↓ 검증 (sessionStorage에 저장)
[/admin 라우트] → AdminGuard 확인
      ↓
[AdminLayout] → 사이드바 + Outlet
      ├─ /admin (대시보드)
      ├─ /admin/users (사용자 관리)
      └─ /admin/projects (프로젝트 관리)
```

---

## 2. 컴포넌트 상세 설계

### 2.1 useAdminAuth 훅

**파일**: `src/features/admin/hooks/useAdminAuth.ts`

```typescript
const ADMIN_KEY = 'gs-admin-authenticated';

export function useAdminAuth() {
  const [isAdmin, setIsAdmin] = useState<boolean>(
    () => sessionStorage.getItem(ADMIN_KEY) === 'true'
  );

  const authenticate = (password: string): boolean => {
    const adminPassword = import.meta.env.VITE_ADMIN_PASSWORD as string;
    if (password === adminPassword) {
      sessionStorage.setItem(ADMIN_KEY, 'true');
      setIsAdmin(true);
      return true;
    }
    return false;
  };

  const logout = () => {
    sessionStorage.removeItem(ADMIN_KEY);
    setIsAdmin(false);
  };

  return { isAdmin, authenticate, logout };
}
```

**설계 결정:**
- `sessionStorage` 사용 → 탭 닫으면 해제, 새로고침에는 유지
- `import.meta.env.VITE_ADMIN_PASSWORD` → `.env`에서 비밀번호 관리
- 상태 변경 시 React 리렌더링 트리거

---

### 2.2 AdminPasswordModal

**파일**: `src/features/admin/components/AdminPasswordModal.tsx`

**Props:**
```typescript
type AdminPasswordModalProps = {
  open: boolean;
  onClose: () => void;
  onSuccess: () => void;
};
```

**UI 구조:**
```
┌──────────────────────────────┐
│ 관리자 인증                    │ ← 타이틀
├──────────────────────────────┤
│                              │
│  비밀번호                     │ ← 라벨
│  ┌────────────────────────┐  │
│  │ ••••••••               │  │ ← password input (autoFocus)
│  └────────────────────────┘  │
│  ⚠ 비밀번호가 틀렸습니다.      │ ← 에러 메시지 (조건부)
│                              │
│          [취소]  [확인]       │ ← 버튼
└──────────────────────────────┘
```

**동작:**
- `open=true`일 때 모달 표시 (배경 딤)
- 비밀번호 입력 후 Enter 또는 '확인' 클릭 → `useAdminAuth().authenticate()` 호출
- 성공 → `onSuccess()` (navigate to /admin)
- 실패 → 에러 메시지 표시, input 초기화
- Escape 키 → `onClose()`
- 기존 `GlobalProcessHeader`의 로그아웃 확인 모달과 동일한 스타일링

---

### 2.3 AdminGuard (라우트 가드)

**파일**: `src/features/admin/routes/AdminGuard.tsx`

```typescript
export function AdminGuard() {
  const { isAdmin } = useAdminAuth();

  if (!isAdmin) {
    return <Navigate to="/dashboard" replace />;
  }

  return <Outlet />;
}
```

**설계 결정:**
- `sessionStorage` 기반 검증
- 미인증 시 `/dashboard`로 리다이렉트 (에러 메시지 없이 조용히)
- `<Outlet />`으로 하위 라우트 렌더링

---

### 2.4 AdminLayout

**파일**: `src/features/admin/components/AdminLayout.tsx`

**UI 구조:**
```
┌─────────────────────────────────────────────────────────┐
│ [← 돌아가기]   GS 시험 가이드 - 관리자        [로그아웃] │ ← 상단 바
├──────────┬──────────────────────────────────────────────┤
│          │                                              │
│ 사용자   │         (Outlet - 콘텐츠 영역)               │
│ 관리     │                                              │
│          │                                              │
│ 프로젝트 │                                              │
│ 관리     │                                              │
│          │                                              │
├──────────┤                                              │
│          │                                              │
│          │                                              │
└──────────┴──────────────────────────────────────────────┘
```

**Props:** 없음 (Context에서 데이터 접근)

**사이드바 항목:**
```typescript
const NAV_ITEMS = [
  { path: '/admin/users', label: '사용자 관리', icon: Users },
  { path: '/admin/projects', label: '프로젝트 관리', icon: FolderKanban },
];
```

**상단 바:**
- 좌측: '← 돌아가기' 버튼 → `/dashboard`로 이동
- 중앙: 타이틀 "GS 시험 가이드 - 관리자"
- 우측: '관리자 나가기' 버튼 → `useAdminAuth().logout()` 후 `/dashboard`로 이동

---

### 2.5 UserManagement

**파일**: `src/features/admin/components/UserManagement.tsx`

**데이터 소스:** `useTestSetupContext()`에서 `users`, `createUser`, `updateUser`, `deleteUser` 사용

**UI 구조:**
```
┌──────────────────────────────────────────────────────┐
│ 사용자 관리                          [+ 사용자 추가]  │
├──────────────────────────────────────────────────────┤
│ ┌──────┬──────┬──────┬──────┬───────┬─────────────┐ │
│ │ 이름 │ 직급 │ 이메일│ 연락처│ 역할  │ 작업        │ │
│ ├──────┼──────┼──────┼──────┼───────┼─────────────┤ │
│ │모상현│ 전임 │ ...  │ ...  │Tester │ [수정][삭제]│ │
│ │      │      │      │      │       │             │ │
│ └──────┴──────┴──────┴──────┴───────┴─────────────┘ │
└──────────────────────────────────────────────────────┘
```

**기능:**
- 사용자 목록 (테이블)
- '사용자 추가' 버튼 → 인라인 폼 또는 모달
- 사용자 수정 (인라인 편집)
- 사용자 삭제 (확인 팝업)
- PL 디렉토리에서 정보 가져오기 버튼 (선택)

**사용자 추가/수정 폼 필드:**
| 필드 | 타입 | 필수 | 비고 |
|------|------|:----:|------|
| 이름 | text | O | |
| 직급 | select | O | 전임/선임/책임/수석 |
| 이메일 | email | O | |
| 연락처 | tel | O | |

---

### 2.6 ProjectManagement

**파일**: `src/features/admin/components/ProjectManagement.tsx`

**데이터 소스:** `useTestSetupContext()`에서 `projects`, `users` 사용 + Firestore 직접 CRUD

**UI 구조:**
```
┌──────────────────────────────────────────────────────┐
│ 프로젝트 관리                       [+ 프로젝트 생성] │
├──────────────────────────────────────────────────────┤
│ ┌──────┬──────┬────────┬──────┬───────┬───────────┐ │
│ │시험번호│제품명│ 업체   │ 상태 │시험원 │ 작업      │ │
│ ├──────┼──────┼────────┼──────┼───────┼───────────┤ │
│ │GS-001│ ...  │ (주)A  │ 진행 │ 모상현│[배정][...]│ │
│ │      │      │        │      │       │           │ │
│ └──────┴──────┴────────┴──────┴───────┴───────────┘ │
└──────────────────────────────────────────────────────┘
```

**기능:**
- 프로젝트 목록 (테이블)
- 프로젝트 생성 (기존 `createProjectFromInput` 활용)
- 시험원 배정 (드롭다운에서 users 목록 선택)
- 프로젝트 상태 변경 (대기/진행/중단/완료/재시험)
- 프로젝트 삭제 (확인 팝업)

**시험원 배정 흐름:**
```
프로젝트 행의 [배정] 버튼 → 드롭다운 (users 목록)
→ 선택 시 Firestore projects/{id} 업데이트
   ├─ testerId: user.id
   ├─ testerName: user.name
   ├─ testerPhone: user.phone
   └─ testerEmail: user.email
```

---

## 3. 라우트 설계

### 3.1 routes.tsx 변경

**변경 전:**
```tsx
<Routes>
  <Route index element={<Navigate to="/dashboard" replace />} />
  <Route path="dashboard" element={<OverviewPage />} />
  <Route path="design" element={<DesignPage />} />
  <Route element={<WorkspaceLayout />}>
    <Route path="execution" element={<ExecutionPage />} />
    <Route path="report" element={<ReportPage />} />
  </Route>
  <Route path="*" element={<Navigate to="/dashboard" replace />} />
</Routes>
```

**변경 후:**
```tsx
<Routes>
  {/* 기존 라우트 (변경 없음) */}
  <Route index element={<Navigate to="/dashboard" replace />} />
  <Route path="dashboard" element={<OverviewPage />} />
  <Route path="design" element={<DesignPage />} />
  <Route element={<WorkspaceLayout />}>
    <Route path="execution" element={<ExecutionPage />} />
    <Route path="report" element={<ReportPage />} />
  </Route>

  {/* 어드민 라우트 (신규) */}
  <Route element={<AdminGuard />}>
    <Route path="admin" element={<AdminLayout />}>
      <Route index element={<Navigate to="users" replace />} />
      <Route path="users" element={<UserManagement />} />
      <Route path="projects" element={<ProjectManagement />} />
    </Route>
  </Route>

  <Route path="*" element={<Navigate to="/dashboard" replace />} />
</Routes>
```

---

## 4. 환경 변수

### .env 추가

```
VITE_ADMIN_PASSWORD=12Sqecd34!
```

### env.d.ts (타입 안전)

```typescript
// src/vite-env.d.ts에 추가
interface ImportMetaEnv {
  readonly VITE_ADMIN_PASSWORD: string;
}
```

---

## 5. 관리자 버튼 배치

### GlobalProcessHeader 변경

**위치**: `src/components/Layout/GlobalProcessHeader.tsx`

기존 우측 영역(업체정보 + 로그아웃 버튼 사이)에 '관리자' 버튼 추가:

```tsx
// 기존 버튼들 사이에 추가
<button
  type="button"
  onClick={onOpenAdmin}
  className="inline-flex items-center gap-1 h-9 rounded-lg border border-slate-200 px-3 text-xs font-semibold text-slate-500 hover:text-slate-700 hover:border-slate-300"
  aria-label="관리자 페이지"
  title="관리자 페이지"
>
  <Settings size={14} />
  <span className="hidden lg:inline">관리자</span>
</button>
```

**Props 추가:**
```typescript
type GlobalProcessHeaderProps = {
  // ... 기존 props
  onOpenAdmin?: () => void;  // 신규
};
```

### OverviewPage에서도 버튼 배치

대시보드(첫 화면)에는 `GlobalProcessHeader`가 아닌 `TestSetupPage`가 렌더링됨.
`TestSetupPage` 상단에도 관리자 버튼이 필요.

**방법**: `TestSetupPage`에 관리자 버튼을 직접 추가하거나, `OverviewPage` 래퍼에서 처리.

---

## 6. 파일 목록 & 구현 순서

### Phase 1: 어드민 인증 인프라

| 순서 | 파일 | 작업 |
|:----:|------|------|
| 1-1 | `.env` | `VITE_ADMIN_PASSWORD=12Sqecd34!` 추가 |
| 1-2 | `src/features/admin/hooks/useAdminAuth.ts` | 신규 생성 |
| 1-3 | `src/features/admin/components/AdminPasswordModal.tsx` | 신규 생성 |

### Phase 2: 어드민 라우트 & 레이아웃

| 순서 | 파일 | 작업 |
|:----:|------|------|
| 2-1 | `src/features/admin/routes/AdminGuard.tsx` | 신규 생성 |
| 2-2 | `src/features/admin/components/AdminLayout.tsx` | 신규 생성 |
| 2-3 | `src/routes.tsx` | `/admin/*` 라우트 추가 |

### Phase 3: 관리자 버튼 통합

| 순서 | 파일 | 작업 |
|:----:|------|------|
| 3-1 | 대시보드 영역 | 관리자 버튼 + 모달 통합 |

### Phase 4: 어드민 기능 페이지

| 순서 | 파일 | 작업 |
|:----:|------|------|
| 4-1 | `src/features/admin/components/UserManagement.tsx` | 사용자 CRUD |
| 4-2 | `src/features/admin/components/ProjectManagement.tsx` | 프로젝트 관리 |

### Phase 5: 검증

| 순서 | 작업 |
|:----:|------|
| 5-1 | `tsc --noEmit` 통과 |
| 5-2 | `vite build` 통과 |
| 5-3 | 비밀번호 팝업 → 어드민 진입 동작 확인 |
| 5-4 | URL 직접 접근 차단 확인 |

---

## 7. 스타일링 규칙

### 어드민 페이지 색상 테마
- **사이드바 배경**: `bg-slate-900` (기존 앱과 구분)
- **사이드바 텍스트**: `text-slate-300`, 활성: `text-white bg-slate-800`
- **콘텐츠 영역**: `bg-slate-50` (기존 앱과 동일)
- **테이블**: 기존 앱의 border/rounded 패턴 유지
- **버튼**: 기존 `Button` 컴포넌트 재사용

### 반응형 고려
- 사이드바: 데스크톱만 (모바일에서는 상단 탭으로 전환 또는 숨김)
- 테이블: 가로 스크롤 허용 (`overflow-x-auto`)

---

## 8. 기존 코드 재사용 매핑

| 필요 기능 | 기존 코드 | 재사용 방법 |
|----------|----------|------------|
| 사용자 CRUD | `useDirectoryActions` | 그대로 호출 |
| 사용자 목록 | `useUsers` | Context에서 `users` 사용 |
| 프로젝트 목록 | `useProjects` | Context에서 `projects` 사용 |
| 프로젝트 생성 | `createProjectFromInput` | Context에서 호출 |
| UI 컴포넌트 | `Button`, `Input` | import 사용 |
| 모달 패턴 | `GlobalProcessHeader`의 로그아웃 모달 | 동일 스타일 적용 |
